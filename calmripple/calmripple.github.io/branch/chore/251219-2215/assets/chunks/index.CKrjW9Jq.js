import{d as z,c as L,o as P,r as G,e as D,_ as K,z as Q,h as m,F as le,w as R,k as F,q as U,b,p as v,t as X,m as J,a as f,I as ue,N as Y,j as g,gt as k,g as pe,gu as ce,C as de,D as fe,E as ve,ag as he}from"./framework.BN_kmrHV.js";import{c as me}from"./theme.BNbM84uM.js";const we=["href"],ge={key:0,class:"VPNolebaseInlinePreviewLinkPopupOpenBtnIcon","i-icon-park-outline:full-screen-one":"","inline-flex":"~","ml-2":"","items-center":"","justify-center":"","text-xs":""},Pe=z({__name:"LinkButton",props:{showExternalIcon:{type:Boolean},href:{}},setup(a){const t=a;return(e,o)=>(P(),L("a",{flex:"~",href:t.href,class:"VPNolebaseInlinePreviewLinkPopupOpenBtn text-$vp-c-brand-1 active:brightness-95 hover:brightness-97",transition:"all duration-200 ease",bg:"$vp-c-bg",border:"1 solid $vp-c-divider",shadow:"sm",absolute:"","bottom-0":"","m-4":"","items-center":"","rounded-lg":"","px-4":"","py-2":"","text-sm":""},[G(e.$slots,"default",{},void 0,!0),t.showExternalIcon?(P(),L("span",ge)):D("",!0)],8,we))}}),Ie=K(Pe,[["__scopeId","data-v-c58f3706"]]),x=Symbol("VPNolebaseInlineLinkPreview"),w={popupWidth:600,popupHeight:480,previewLocalHostName:!0,selectorsToBeHided:[".VPNav",".VPFooter",".VPLocalNav",".VPSidebar",".VPDocFooter > .prev-next"],popupTeleportTargetSelector:"body",popupDelay:500};var H={popup:{loading:"Loading",loadingAriaLabel:"Loading",openInCurrentPage:"Open in current page",openInCurrentPageAriaLabel:"Open in current page",iframeAriaLabel:"Inline link preview of link at {href}"}};H.popup;var N={popup:{loading:"加载中",loadingAriaLabel:"加载中",openInCurrentPage:"在当前页面打开",openInCurrentPageAriaLabel:"在当前页面打开",iframeAriaLabel:"在 {href} 的链接的行内链接预览"}};N.popup;const be={"zh-CN":N,"zh-Hans":N,zh:N,"en-US":H,en:H},Le=me(x,be,H);function q(a,t,e){return new Promise((o,i)=>{let u=0;function p(){u++;try{const s=e();s instanceof Promise?s.then(h=>{h?o(h):u<a?setTimeout(p,t):o(null)}).catch(h=>{u<a?setTimeout(p,t):i(h)}):s?o(s):u<a?setTimeout(p,t):o(null)}catch(s){u<a?setTimeout(p,t):i(s)}}p()})}const ye=["src","aria-label"],_e=["aria-label"],ke={flex:"1"},Ne=z({__name:"PopupIframe",props:{href:{}},setup(a){const t=a,e=Q(x,w),o=m(!0),{t:i}=Le();async function u(l){return await q(50,200,()=>l.contentDocument?l.contentDocument:u(l))}async function p(l,r){return await q(3,100,()=>{const c=l.querySelector(r);return c||null})}async function s(l,r){const c=await u(l);return c?{selector:r,element:await p(c,r)}:{selector:r,element:null}}async function h(l){const r=l.target,c=e.selectorsToBeHided||w.selectorsToBeHided||[];let y=[];try{y=await Promise.all(c.map(d=>s(r,d)))}catch(d){console.error("VPNolebaseInlinePreviewLink:",d)}y.forEach(d=>{d.element?d.element.style.setProperty("display","none","important"):console.warn(`VPNolebaseInlinePreviewLink: desired selecting element with selector '${d.selector}' not found. Consider remove it from 'options.selectorsToBeHided' if it's not constantly rendered.`)}),e.handleIframeLoaded&&(e.handleIframeLoaded instanceof Promise?await e.handleIframeLoaded(window,r):e.handleIframeLoaded(window,r)),setTimeout(()=>{o.value=!1},250)}return(l,r)=>(P(),L(le,null,[R(b("iframe",{border:"none","m-0":"","w-full":"","overflow-hidden":"","rounded-lg":"","p-0":"",class:"VPNolebaseInlinePreviewLinkPopupIframe",flex:"1",src:t.href,"aria-label":v(i)("popup.iframeAriaLabel",{props:{href:t.href}}),onLoad:h},null,40,ye),[[U,!o.value]]),R(b("div",{flex:"~ col 1","m-0":"","w-full":"","items-center":"","justify-center":"","p-0":"",class:"VPNolebaseInlinePreviewLinkPopupLoading bg-$vp-c-bg text-$vp-c-text-1","aria-label":v(i)("popup.loadingAriaLabel")},[r[0]||(r[0]=b("span",{"i-svg-spinners:3-dots-bounce":"","text-3xl":""},null,-1)),b("span",null,X(v(i)("popup.loading")),1)],8,_e),[[U,o.value]]),F(Ie,{href:t.href,title:v(i)("popup.openInCurrentPage"),"aria-label":v(i)("popup.openInCurrentPage"),"show-external-icon":""},{default:J(()=>[b("span",ke,X(v(i)("popup.openInCurrentPage")),1)]),_:1},8,["href","title","aria-label"])],64))}});function He(){return{livesInIframe:f(()=>{try{return window.self!==window.top&&window.top!==void 0&&window.top!==null&&"location"in window.top}catch{return!1}})}}const xe=["href"],Oe=z({__name:"InlineLinkPreview",props:{href:{}},setup(a){const t=a,e=Q(x,w),o=m(),i=m(),u=f(()=>e.popupWidth&&e.popupWidth>0?e.popupWidth:w.popupWidth||600),p=f(()=>e.popupHeight&&e.popupHeight>0?e.popupHeight:w.popupHeight||480),s=f(()=>e.popupDelay&&e.popupDelay>0?e.popupDelay:w.popupDelay||1e3),h=f(()=>e.popupTeleportTargetSelector||w.popupTeleportTargetSelector||"body"),l=fe(),{width:r,height:c}=he(),{livesInIframe:y}=He(),d=ue("(min-width: 768px)"),{isOutside:Z}=Y(o),{isOutside:ee}=Y(i),O=m(!1),E=m(!1);g(o,n=>{n&&(n.addEventListener("mouseenter",()=>{O.value=!0}),n.addEventListener("mouseleave",()=>{O.value=!1}))}),g(i,n=>{n&&(n.addEventListener("mouseenter",()=>{E.value=!0}),n.addEventListener("mouseleave",()=>{E.value=!1}))});const A=k(Z,s.value),S=k(ee,s.value),T=k(O,s.value),B=k(E,s.value),$=m(0),V=m(0),W=m(!1),te=f(()=>t.href.startsWith("#")),I=f(()=>{if(te.value)return"";try{return new URL(t.href,window.location.href).host}catch{return""}}),ne=f(()=>!window||!window.location||!I.value?!1:e.previewAllHostNames?!0:(e.previewLocalHostName===void 0?w.previewLocalHostName:e.previewLocalHostName)?window.location.host===I.value:typeof e.handleShouldPreviewHostNames=="function"?e.handleShouldPreviewHostNames(I.value):Array.isArray(e.previewHostNamesBlocked)&&e.previewHostNamesBlocked.includes(I.value)?!1:!!(Array.isArray(e.previewHostNamesAllowed)&&e.previewHostNamesAllowed.includes(I.value))),oe=f(()=>!y.value&&ne.value&&W.value);function _(n){if(n){setTimeout(()=>{A.value&&!T.value&&S.value&&!B.value&&(W.value=!1)},200);return}if(!((T.value||B.value)&&(!A.value||!S.value))||!o.value)return;W.value=!0;const{x:C,y:j,right:re,height:ae,width:ie,bottom:se}=o.value.getBoundingClientRect();re+u.value<r.value?$.value=C+window.scrollX:$.value=C+window.scrollX-u.value+ie,se+p.value<c.value?V.value=j+window.scrollY+ae+4:V.value=j+window.scrollY-p.value-4}return g(A,n=>_(n)),g(T,n=>_(!n)),g(S,n=>_(n)),g(B,n=>_(!n)),(n,C)=>(P(),L("a",{ref_key:"anchorElement",ref:o,class:"VPNolebaseInlinePreviewLink",relative:"",href:t.href},[G(n.$slots,"default",{},void 0,!0),v(l)&&v(d)?(P(),pe(de,{key:0,to:h.value},[F(ce,{name:"fade"},{default:J(()=>[v(l)&&oe.value?(P(),L("div",{key:0,ref_key:"iframeWrapperElement",ref:i,flex:"~ col",absolute:"","top-0":"","z-100":"","m-0":"","overflow-hidden":"","rounded-lg":"","p-0":"",border:"1 solid $vp-c-divider",class:"VPNolebaseInlinePreviewLinkWrapper max-w-[100vw]",style:ve({left:`${$.value}px`,top:`${V.value}px`,width:`${u.value}px`,height:`${p.value}px`}),shadow:"2xl"},[F(Ne,{href:t.href},null,8,["href"])],4)):D("",!0)]),_:1})],8,["to"])):D("",!0)],8,xe))}}),Ee=K(Oe,[["__scopeId","data-v-6944d4ad"]]),M={VPNolebaseInlineLinkPreview:Ee},$e={install(a,t){typeof t<"u"&&typeof t=="object"&&a.provide(x,t);for(const e of Object.keys(M))a.component(e,M[e])}};export{x as InjectionKey,Ee as NolebaseInlineLinkPreview,$e as NolebaseInlineLinkPreviewPlugin,Ne as PopupIframe};
