import{d as le,h as ie,a8 as we,ao as Se,c as J,o as K,k as se,m as Ee,e as ze,E as ne,T as Le,p as ve,F as xe}from"./framework.BN_kmrHV.js";function ue(e,t,r){const o=e*4+1,s=6+t*(5+o),n=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,e>>8,e&255,0,0,t>>8,t&255,8,6,0,0,0,0,0,0,0,s>>>24,s>>16&255,s>>8&255,s&255,73,68,65,84,120,1],c=[0,498536548,997073096,651767980,1994146192,1802195444,1303535960,1342533948,-306674912,-267414716,-690576408,-882789492,-1687895376,-2032938284,-1609899400,-1111625188];let d=1,a=0;for(let f=0,u=0,l=o-1;f<t;f++,l+=o-1)for(n.push(f+1<t?0:1,o&255,o>>8,~o&255,o>>8^255,0),a=(a+d)%65521;u<l;u++){const m=r[u]&255;n.push(m),d=(d+m)%65521,a=(a+d)%65521}n.push(a>>8,a&255,d>>8,d&255,0,0,0,0,0,0,0,0,73,69,78,68,174,66,96,130);for(let[f,u]of[[12,29],[37,41+s]]){let l=-1;for(let m=f;m<u;m++)l^=n[m],l=l>>>4^c[l&15],l=l>>>4^c[l&15];l=~l,n[u++]=l>>>24,n[u++]=l>>16&255,n[u++]=l>>8&255,n[u++]=l&255}return`data:image/png;base64,${globalThis.btoa(String.fromCharCode(...n))}`}const de=new Uint8Array(128);for(let e=0;e<83;e++)de["0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz#$%*+,-.:;=?@[]^_{|}~".charCodeAt(e)]=e;const W=(e,t,r)=>{let o=0;for(;t<r;)o*=83,o+=de[e.charCodeAt(t++)];return o},fe=Math.pow,D=Math.PI,Ie=D*2,he=3294.6,pe=269.025,Ce=e=>e>10.31475?fe(e/pe+.052132,2.4):e/he,X=e=>~~(e>1227e-8?pe*fe(e,.416666)-13.025:e*he+1),B=e=>(e<0?-1:1)*e*e,ce=e=>{for(e+=D/2;e>D;)e-=Ie;const t=1.27323954*e-.405284735*B(e);return .225*(B(t)-t)+t};function Ue(e){const t=W(e,2,6);return[t>>16,t>>8&255,t&255]}function Ne(e,t,r,o){const s=W(e,0,1),n=s%9+1,c=~~(s/9)+1,d=n*c;let a=0,h=0,f=0,u=0,l=0,m=0,C=0,A=0,z=0,_=0,w=0,L=0;const U=(W(e,1,2)+1)/13446*(o|1),y=new Float64Array(d*3),v=Ue(e);for(a=0;a<3;a++)y[a]=Ce(v[a]);for(a=1;a<d;a++)L=W(e,4+a*2,6+a*2),y[a*3]=B(~~(L/361)-9)*U,y[a*3+1]=B(~~(L/19)%19-9)*U,y[a*3+2]=B(L%19-9)*U;const H=new Float64Array(c*r),P=new Float64Array(n*t);for(h=0;h<c;h++)for(u=0;u<r;u++)H[h*r+u]=ce(D*u*h/r);for(a=0;a<n;a++)for(f=0;f<t;f++)P[a*t+f]=ce(D*f*a/t);const R=t*4,S=new Uint8ClampedArray(R*r);for(u=0;u<r;u++)for(f=0;f<t;f++){for(l=m=C=0,h=0;h<c;h++)for(z=H[h*r+u],a=0;a<n;a++)A=P[a*t+f]*z,_=(a+h*n)*3,l+=y[_]*A,m+=y[_+1]*A,C+=y[_+2]*A;w=4*f+u*R,S[w]=X(l),S[w+1]=X(m),S[w+2]=X(C),S[w+3]=255}return S}const ee=32,Ge="data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1 1'%3E%3C/svg%3E";function Te(e,{ratio:t=1,size:r=ee}={}){const{width:o,height:s}=Oe(t,r),n=Ne(e,o,s);return ue(o,s,n)}function Oe(e,t){const r=e>=1;return{width:r?t:Math.round(t*e),height:r?Math.round(t/e):t}}function Be(e){let{PI:t,min:r,max:o,cos:s,round:n}=Math,c=e[0]|e[1]<<8|e[2]<<16,d=e[3]|e[4]<<8,a=(c&63)/63,h=(c>>6&63)/31.5-1,f=(c>>12&63)/31.5-1,u=(c>>18&31)/31,l=c>>23,m=(d>>3&63)/63,C=(d>>9&63)/63,A=d>>15,z=o(3,A?l?5:7:d&7),_=o(3,A?d&7:l?5:7),w=l?(e[5]&15)/15:1,L=(e[5]>>4)/15,U=l?6:5,y=0,v=(G,g,T)=>{let x=[];for(let E=0;E<g;E++)for(let I=E?0:1;I*g<G*(g-E);I++)x.push(((e[U+(y>>1)]>>((y++&1)<<2)&15)/7.5-1)*T);return x},H=v(z,_,u),P=v(3,3,m*1.25),R=v(3,3,C*1.25),S=l&&v(5,5,L),$=De(e),F=n($>1?32:32*$),M=n($>1?32/$:32),N=new Uint8Array(F*M*4),q=[],Y=[];for(let G=0,g=0;G<M;G++)for(let T=0;T<F;T++,g+=4){let x=a,E=h,I=f,te=w;for(let i=0,p=o(z,l?5:3);i<p;i++)q[i]=s(t/F*(T+.5)*i);for(let i=0,p=o(_,l?5:3);i<p;i++)Y[i]=s(t/M*(G+.5)*i);for(let i=0,p=0;i<_;i++)for(let b=i?0:1,O=Y[i]*2;b*_<z*(_-i);b++,p++)x+=H[p]*q[b]*O;for(let i=0,p=0;i<3;i++)for(let b=i?0:1,O=Y[i]*2;b<3-i;b++,p++){let ae=q[b]*O;E+=P[p]*ae,I+=R[p]*ae}if(l)for(let i=0,p=0;i<5;i++)for(let b=i?0:1,O=Y[i]*2;b<5-i;b++,p++)te+=S[p]*q[b]*O;let re=x-2/3*E,oe=(3*x-re+I)/2,Ae=oe-I;N[g]=o(0,255*r(1,oe)),N[g+1]=o(0,255*r(1,Ae)),N[g+2]=o(0,255*r(1,re)),N[g+3]=o(0,255*r(1,te))}return{w:F,h:M,rgba:N}}function De(e){let t=e[3],r=e[2]&128,o=e[4]&128,s=o?r?5:7:t&7,n=o?t&7:r?5:7;return s/n}function He(e){const t=Pe(e),{w:r,h:o,rgba:s}=Be(t);return ue(r,o,s)}function Pe(e){return Uint8Array.from(globalThis.atob(Re(e)),t=>t.charCodeAt(0))}function Re(e){return e.replaceAll("-","+").replaceAll("_","/")}const me=typeof window>"u",$e=!me&&"loading"in HTMLImageElement.prototype,Fe=!me&&(!("onscroll"in window)||/(?:gle|ing|ro)bot|crawl|spider/i.test(navigator.userAgent));function be(e,t=document){return typeof e=="string"?[...t.querySelectorAll(e)]:e instanceof Element?[e]:[...e]}function Me(e){const t=Date.now();return Ge.replace(/\s/,` data-id='${t}-${e}' `)}function qe(e,t){let r;return function(...o){r!=null&&clearTimeout(r),r=setTimeout(()=>{e(...o),r=void 0},t)}}function Ye(e='img[loading="lazy"]',{hash:t=!0,hashType:r="blurhash",placeholderSize:o=ee,updateSizesOnResize:s=!1,onImageLoad:n}={}){const c=new Set;for(const[d,a]of be(e).entries()){const h=Z(a,{updateOnResize:s});if(s&&h&&c.add(h),(typeof __UNLAZY_HASH_DECODING__>"u"||__UNLAZY_HASH_DECODING__)&&t){const u=We({image:a,hash:typeof t=="string"?t:void 0,hashType:r,size:o});u&&(a.src=u)}if(!a.dataset.src&&!a.dataset.srcset){(typeof __UNLAZY_LOGGING__>"u"||__UNLAZY_LOGGING__)&&console.error("[unlazy] Missing `data-src` or `data-srcset` attribute",a);continue}if(Fe||!$e){_e(a),V(a),j(a);continue}if(a.src||(a.src=Me(d)),a.complete&&a.naturalWidth>0){Q(a,n);continue}const f=()=>Q(a,n);a.addEventListener("load",f,{once:!0}),c.add(()=>a.removeEventListener("load",f))}return()=>{for(const d of c)d();c.clear()}}function ke(e='img[data-sizes="auto"], source[data-sizes="auto"]'){for(const t of be(e))Z(t)}function Q(e,t){if(ge(e)){_e(e),V(e),j(e),t?.(e);return}const r=new Image,{srcset:o,src:s,sizes:n}=e.dataset;if(n==="auto"){const c=ye(e);c&&(r.sizes=`${c}px`)}else e.sizes&&(r.sizes=e.sizes);o&&(r.srcset=o),s&&(r.src=s),r.addEventListener("load",()=>{V(e),j(e),t?.(e)},{once:!0})}function We({image:e,hash:t,hashType:r="blurhash",size:o=ee,ratio:s}={}){if(e&&!t){const{blurhash:n,thumbhash:c}=e.dataset;t=c||n,r=c?"thumbhash":"blurhash"}if(t)try{if(r==="blurhash"){if(e&&!s){const n=e.width||e.offsetWidth||o,c=e.height||e.offsetHeight||o;s=n/c}return Te(t,{ratio:s,size:o})}return He(t)}catch(n){(typeof __UNLAZY_LOGGING__>"u"||__UNLAZY_LOGGING__)&&console.error(`[unlazy] Failed to generate ${r} placeholder:`,n)}}const k=new WeakMap;function Z(e,t){if(e.dataset.sizes!=="auto")return;const r=ye(e);if(r&&(e.sizes=`${r}px`),ge(e)&&t?.processSourceElements)for(const o of[...e.parentElement.getElementsByTagName("source")])Z(o,{processSourceElements:!0});if(t?.updateOnResize){if(!k.has(e)){const o=qe(()=>Z(e),500),s=new ResizeObserver(o);k.set(e,s),s.observe(e)}return()=>{const o=k.get(e);o&&(o.disconnect(),k.delete(e))}}}function j(e){e.dataset.src&&(e.src=e.dataset.src,e.removeAttribute("data-src"))}function V(e){e.dataset.srcset&&(e.srcset=e.dataset.srcset,e.removeAttribute("data-srcset"))}function _e(e){const t=e.parentElement;t?.tagName.toLowerCase()==="picture"&&([...t.querySelectorAll("source[data-srcset]")].forEach(V),[...t.querySelectorAll("source[data-src]")].forEach(j))}function ye(e){return e instanceof HTMLSourceElement?e.parentElement?.getElementsByTagName("img")[0]?.offsetWidth:e.offsetWidth}function ge(e){return e.parentElement?.tagName.toLowerCase()==="picture"}const Ze=["src","data-src","data-srcset","data-sizes","loading"],je=le({__name:"UnLazyImage",props:{src:{},srcSet:{},autoSizes:{type:Boolean},blurhash:{},thumbhash:{},placeholderSrc:{},placeholderSize:{},preload:{type:Boolean},loading:{}},emits:["loaded","error"],setup(e,{emit:t}){const r=e,o=t,s=ie();let n;return we(()=>{if(n?.(),!!s.value){if(r.preload){r.autoSizes&&ke(s.value),Q(s.value,c=>o("loaded",c));return}n=Ye(s.value,{hash:r.thumbhash||r.blurhash,hashType:r.thumbhash?"thumbhash":"blurhash",placeholderSize:r.placeholderSize,onImageLoad:c=>o("loaded",c)})}}),Se(()=>{n?.()}),(c,d)=>(K(),J("img",{ref_key:"target",ref:s,src:e.placeholderSrc,"data-src":e.src,"data-srcset":e.srcSet,"data-sizes":e.autoSizes?"auto":void 0,loading:e.loading||"lazy",onError:d[0]||(d[0]=a=>o("error",a))},null,40,Ze))}}),Ve=["src","width","height"],Je=le({__name:"NolebaseUnlazyImg",props:{src:{},alt:{},thumbhash:{},placeholderSrc:{},width:{},height:{},autoSizes:{default:"true"}},setup(e){const t=e,r=ie(!1);function o(){r.value=!0}return(s,n)=>(K(),J(xe,null,[se(Le,{"leave-active-class":"animate-fade-out animate-duration-750 animate-ease-in-out"},{default:Ee(()=>[r.value?ze("",!0):(K(),J("img",{key:0,class:"nolebase-enhanced-img absolute inset-0 z-1 bg-black/10",src:t.placeholderSrc,width:t.width,height:t.height,style:ne({aspectRatio:`${t.width} / ${t.height}`})},null,12,Ve))]),_:1}),se(ve(je),{src:t.src,alt:t.alt,thumbhash:t.thumbhash,"placeholder-src":t.placeholderSrc,width:t.width,height:t.height,style:ne({aspectRatio:`${t.width} / ${t.height}`}),onLoaded:o},null,8,["src","alt","thumbhash","placeholder-src","width","height","style"])],64))}});export{Je as NolebaseUnlazyImg};
