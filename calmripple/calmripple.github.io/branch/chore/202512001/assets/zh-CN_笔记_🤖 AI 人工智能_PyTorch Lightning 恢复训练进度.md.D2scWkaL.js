import{_ as r,ad as n,c as g,o as d,b as i,k as a,aE as y,a5 as t,m as l}from"./chunks/framework.BN_kmrHV.js";const f=JSON.parse('{"title":"PyTorch Lightning æ¢å¤è®­ç»ƒè¿›åº¦","description":"","frontmatter":{"tags":["AI","AI/PyTorch","å¼€å‘/Python/PyTorch","å¼€å‘/Python/PyTorchLightning","å¼€å‘/Python"]},"headers":[],"relativePath":"zh-CN/ç¬”è®°/ğŸ¤– AI äººå·¥æ™ºèƒ½/PyTorch Lightning æ¢å¤è®­ç»ƒè¿›åº¦.md","filePath":"zh-CN/ç¬”è®°/ğŸ¤– AI äººå·¥æ™ºèƒ½/PyTorch Lightning æ¢å¤è®­ç»ƒè¿›åº¦.md"}'),B={name:"zh-CN/ç¬”è®°/ğŸ¤– AI äººå·¥æ™ºèƒ½/PyTorch Lightning æ¢å¤è®­ç»ƒè¿›åº¦.md"};function o(c,s,A,F,E,C){const k=n("NolebasePageProperties"),h=n("VPNolebaseInlineLinkPreview"),p=n("NolebaseGitContributors"),e=n("NolebaseGitChangelog");return d(),g("div",null,[s[3]||(s[3]=i("h1",{id:"pytorch-lightning-æ¢å¤è®­ç»ƒè¿›åº¦",tabindex:"-1"},[t("PyTorch Lightning æ¢å¤è®­ç»ƒè¿›åº¦ "),i("a",{class:"header-anchor",href:"#pytorch-lightning-æ¢å¤è®­ç»ƒè¿›åº¦","aria-label":"Permalink to â€œPyTorch Lightning æ¢å¤è®­ç»ƒè¿›åº¦â€"},"â€‹")],-1)),a(k),s[4]||(s[4]=y(`<p>ä¸‹é¢çš„ä»£ç åŸºäºè¿™ä¸ªé•œåƒè¿›è¡Œä½œä¸šï¼š</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light one-dark-pro" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;" tabindex="0" dir="ltr"><code><span class="line"><span>huggingface/transformers-pytorch-deepspeed-latest-gpu</span></span></code></pre></div><p>åœ¨é•œåƒä¸­è¿è¡Œä¸‹é¢çš„å‘½ä»¤å®‰è£… <code>lightning</code>ï¼š</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> lightning</span></span></code></pre></div><p>æ·»åŠ ä¿®æ”¹ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light one-dark-pro" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> os</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> glob</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> find_latest_checkpoint</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # è·å–æ‰€æœ‰ç‰ˆæœ¬ç›®å½•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    version_dirs </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> glob.</span><span style="--shiki-light:#24292E;--shiki-dark:#61AFEF;">glob</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;lightning_logs/version_*&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # æŒ‰ç‰ˆæœ¬å·æ’åº</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    version_dirs.</span><span style="--shiki-light:#24292E;--shiki-dark:#61AFEF;">sort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">key</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">lambda</span><span style="--shiki-light:#24292E;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> x</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(x.</span><span style="--shiki-light:#24292E;--shiki-dark:#61AFEF;">split</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;_&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)[</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]))</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # è·å–æœ€æ–°ç‰ˆæœ¬ç›®å½•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    latest_version_dir </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> version_dirs[</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # è·å–è¯¥ç‰ˆæœ¬ç›®å½•ä¸‹çš„æ‰€æœ‰æ£€æŸ¥ç‚¹æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    ckpt_files </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> glob.</span><span style="--shiki-light:#24292E;--shiki-dark:#61AFEF;">glob</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(os.path.</span><span style="--shiki-light:#24292E;--shiki-dark:#61AFEF;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(latest_version_dir, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;checkpoints&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;*.ckpt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # æŒ‰æ­¥éª¤å·æ’åº</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    ckpt_files.</span><span style="--shiki-light:#24292E;--shiki-dark:#61AFEF;">sort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">key</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">lambda</span><span style="--shiki-light:#24292E;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> x</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(x.</span><span style="--shiki-light:#24292E;--shiki-dark:#61AFEF;">split</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;=&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)[</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">].</span><span style="--shiki-light:#24292E;--shiki-dark:#61AFEF;">split</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;.&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]))</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # è·å–æœ€æ–°çš„æ£€æŸ¥ç‚¹æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    latest_ckpt_file </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ckpt_files[</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> latest_ckpt_file</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # rest of the code...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    latest_ckpt_path </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#61AFEF;"> find_latest_checkpoint</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> os.path.</span><span style="--shiki-light:#24292E;--shiki-dark:#61AFEF;">exists</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(latest_ckpt_path):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        logger.</span><span style="--shiki-light:#24292E;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;latest_ckpt_path detected, resuming from </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">latest_ckpt_path</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        trainer.</span><span style="--shiki-light:#24292E;--shiki-dark:#61AFEF;">fit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(model, mnist_data, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">ckpt_path</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">latest_ckpt_path)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        trainer.</span><span style="--shiki-light:#24292E;--shiki-dark:#61AFEF;">fit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(model, mnist_data)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;"> __name__</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ==</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;__main__&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#61AFEF;">    main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span></code></pre></div><p>ä¹‹åè¿è¡Œä¸‹é¢çš„å‘½ä»¤å°±å¯ä»¥è‡ªåŠ¨æ£€æµ‹æœ€æ–°çš„æ£€æŸ¥ç‚¹æ–‡ä»¶å¹¶æ¢å¤è®­ç»ƒè¿›åº¦å•¦ï¼</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light one-dark-pro" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">torchrun</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> main.py</span></span></code></pre></div>`,8)),i("ul",null,[i("li",null,[a(h,{href:"https://help.aliyun.com/zh/pai/user-guide/easyckpt?spm=a2c4g.11186623.0.0.18c02772MLDUbC",target:"_blank",rel:"noreferrer"},{default:l(()=>[...s[0]||(s[0]=[t("easyckptçš„æŠ€æœ¯åŸç†å’Œä½¿ç”¨æ–¹æ³•_äººå·¥æ™ºèƒ½å¹³å° PAI(PAI)-é˜¿é‡Œäº‘å¸®åŠ©ä¸­å¿ƒ",-1)])]),_:1})]),i("li",null,[a(h,{href:"https://help.aliyun.com/zh/pai/user-guide/easyckpt",target:"_blank",rel:"noreferrer"},{default:l(()=>[...s[1]||(s[1]=[t("easyckptçš„æŠ€æœ¯åŸç†å’Œä½¿ç”¨æ–¹æ³•_äººå·¥æ™ºèƒ½å¹³å° PAI(PAI)-é˜¿é‡Œäº‘å¸®åŠ©ä¸­å¿ƒ",-1)])]),_:1})]),i("li",null,[a(h,{href:"https://zhuanlan.zhihu.com/p/159068033",target:"_blank",rel:"noreferrer"},{default:l(()=>[...s[2]||(s[2]=[t("Pytorchæ¨¡å‹resume trainingï¼ŒåŠ è½½æ¨¡å‹åŸºç¡€ä¸Šç»§ç»­è®­ç»ƒ - çŸ¥ä¹",-1)])]),_:1})])]),a(p),a(e)])}const D=r(B,[["render",o]]);export{f as __pageData,D as default};
