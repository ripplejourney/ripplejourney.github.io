import{_ as f,ad as l,c as u,o as p,b as s,k as e,aE as a,a5 as i,m as n}from"./chunks/framework.BN_kmrHV.js";const T=JSON.parse('{"title":"米家设备联动 Home Assistant 自动化时延迟很高","description":"","frontmatter":{"tags":["软件/iOS/Homekit","软件/macOS/Homekit","物联网/智能家居/Homekit","软件/iPadOS/Homekit","开源/软件/Home-Assistant","开源/软件/Home-Assistant/HASS","物联网/智能家居/Home-Assistant","物联网/智能家居/Home-Assistant/HASS","物联网/智能家居/生态/米家","物联网/智能家居/生态/Homekit","物联网","物联网/IoT"],"status":"尚未完成"},"headers":[],"relativePath":"zh-CN/笔记/🧱 基础设施/🏠 物联网/🌳 Home Assistant/米家设备联动 Home Assistant 自动化时延迟很高.md","filePath":"zh-CN/笔记/🧱 基础设施/🏠 物联网/🌳 Home Assistant/米家设备联动 Home Assistant 自动化时延迟很高.md"}'),b={name:"zh-CN/笔记/🧱 基础设施/🏠 物联网/🌳 Home Assistant/米家设备联动 Home Assistant 自动化时延迟很高.md"},k={class:"footnotes"},g={class:"footnotes-list"},h={id:"fn1",class:"footnote-item"};function A(H,t,y,P,x,w){const r=l("NolebasePageProperties"),o=l("VPNolebaseInlineLinkPreview"),m=l("NolebaseGitContributors"),d=l("NolebaseGitChangelog");return p(),u("div",null,[t[38]||(t[38]=s("h1",{id:"米家设备联动-home-assistant-自动化时延迟很高",tabindex:"-1"},[i("米家设备联动 Home Assistant 自动化时延迟很高 "),s("a",{class:"header-anchor",href:"#米家设备联动-home-assistant-自动化时延迟很高","aria-label":"Permalink to “米家设备联动 Home Assistant 自动化时延迟很高”"},"​")],-1)),e(r),t[39]||(t[39]=s("div",{class:"warning custom-block github-alert"},[s("p",{class:"custom-block-title"},"WARNING"),s("p",null,"⚠️ 该文档尚未完成，仍在编写中...")],-1)),t[40]||(t[40]=s("h2",{id:"说明",tabindex:"-1"},[i("说明 "),s("a",{class:"header-anchor",href:"#说明","aria-label":"Permalink to “说明”"},"​")],-1)),s("p",null,[t[1]||(t[1]=i("最近小音 @beknowing 在 Home Assistant 和 Homekit 上给从 Home Assistant 从米家接入的",-1)),e(o,{href:"https://zhuanlan.zhihu.com/p/592187536",target:"_blank",rel:"noreferrer"},{default:n(()=>[...t[0]||(t[0]=[i("子擎的人在传感器",-1)])]),_:1}),t[2]||(t[2]=i("做了一些关于自动开关灯的场景的自动化，然后发现从设备的状态更新，到触发 Home Assistant 的自动化，到 Homekit 灯具开关的流程耗时非常长，可能有 5s 到 10s 不等的延迟。",-1))]),t[41]||(t[41]=s("h2",{id:"哪里来的延迟",tabindex:"-1"},[i("哪里来的延迟 "),s("a",{class:"header-anchor",href:"#哪里来的延迟","aria-label":"Permalink to “哪里来的延迟”"},"​")],-1)),s("p",null,[t[4]||(t[4]=i("直到后来查资料才知道这是因为我们 Home Assistant 中通过 HACS 配置安装的 ",-1)),e(o,{href:"https://github.com/al-one/hass-xiaomi-miot",target:"_blank",rel:"noreferrer"},{default:n(()=>[...t[3]||(t[3]=[i("Xiaomi Miot Auto",-1)])]),_:1}),t[5]||(t[5]=i(" 目前主要是通过轮询的方式获取设备状态，通俗的讲就是每隔几十秒去刷新一次状态。",-1)),t[6]||(t[6]=s("sup",{class:"footnote-ref"},[s("a",{href:"#fn1",id:"fnref1"},"[1]")],-1))]),t[42]||(t[42]=s("h2",{id:"解决方法一-直接改配置来缩短轮询间隔",tabindex:"-1"},[i("解决方法一：直接改配置来缩短轮询间隔 "),s("a",{class:"header-anchor",href:"#解决方法一-直接改配置来缩短轮询间隔","aria-label":"Permalink to “解决方法一：直接改配置来缩短轮询间隔”"},"​")],-1)),s("p",null,[t[8]||(t[8]=i("不过，",-1)),e(o,{href:"https://github.com/al-one/hass-xiaomi-miot",target:"_blank",rel:"noreferrer"},{default:n(()=>[...t[7]||(t[7]=[i("Xiaomi Miot Auto",-1)])]),_:1}),t[9]||(t[9]=i(" 是提供了配置方案的，允许用户修改这个轮询间隔长度：",-1))]),s("blockquote",null,[s("p",null,[t[11]||(t[11]=i("在 Token 方式集成时，这个时长是可以直接修改的(添加集成和修改集成选项均可)，目前默认是 30 秒。 而通过账号集成时，由于一个集成配置会对应多个设备，因此无法统一配置，需要为每个设备实体添加",-1)),e(o,{href:"https://github.com/al-one/hass-xiaomi-miot/issues/100#issuecomment-864678774",target:"_blank",rel:"noreferrer"},{default:n(()=>[...t[10]||(t[10]=[i("自定义属性",-1)])]),_:1}),t[12]||(t[12]=i()),t[13]||(t[13]=s("code",null,"interval_seconds",-1)),t[14]||(t[14]=i(" 来修改轮询时长：",-1))])]),t[43]||(t[43]=a(`<div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light one-dark-pro" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># customize.yaml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">sensor.your_entity_id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  interval_seconds</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # 轮询间隔时长(秒)</span></span></code></pre></div><p>所以这意味着你可以在 HASS 里面的 File Editor 去修改并进行配置。不过这样的方式依然有限制：</p><blockquote><p>一般情况下，对于开关、灯、环境传感器等设备，我们推荐使用默认轮询时长即可，过于频繁的请求状态可能会使设备负载过高，且大部分请求是无意义的。</p><p>对于人体传感器、门磁、无线开关类设备，它们的状态通常为瞬时状态(即：事件)，部分型号支持获取最后一次事件触发的时间，且默认轮询时长为 15 秒，对于无法获取最后触发事件的设备，即使修改轮询时间到 1 秒，也可能无法获取正确的状态。</p></blockquote>`,3)),s("p",null,[e(o,{href:"https://github.com/al-one/hass-xiaomi-miot",target:"_blank",rel:"noreferrer"},{default:n(()=>[...t[15]||(t[15]=[i("Xiaomi Miot Auto",-1)])]),_:1}),t[16]||(t[16]=i(" 的作者也提到说：",-1))]),s("blockquote",null,[s("p",null,[t[19]||(t[19]=s("strong",null,"此类设备通过本插件集成后不太推荐用于触发实时自动化，仅适合作为如几分钟无人移动关灯这类自动化的条件",-1)),t[20]||(t[20]=i("，如果需要实时更新状态，推荐使用",-1)),e(o,{href:"https://home.miot-spec.com/s/lumi.gateway.mgl03",target:"_blank",rel:"noreferrer"},{default:n(()=>[...t[17]||(t[17]=[i("多模网关",-1)])]),_:1}),t[21]||(t[21]=i("配合",-1)),e(o,{href:"https://github.com/AlexxIT/XiaomiGateway3",target:"_blank",rel:"noreferrer"},{default:n(()=>[...t[18]||(t[18]=[i("XiaomiGateway3",-1)])]),_:1}),t[22]||(t[22]=i("集成。",-1))])]),s("p",null,[t[24]||(t[24]=i("那为什么是轮询呢？可以是轮询之外的别的方案吗？",-1)),e(o,{href:"https://github.com/al-one/hass-xiaomi-miot",target:"_blank",rel:"noreferrer"},{default:n(()=>[...t[23]||(t[23]=[i("Xiaomi Miot Auto",-1)])]),_:1}),t[25]||(t[25]=i(" 的作者提到的这个多模网关可以解决这个问题吗？",-1))]),t[44]||(t[44]=s("h2",{id:"解决方法二-多模网关搭配-home-assistant-集成",tabindex:"-1"},[i("解决方法二：多模网关搭配 Home Assistant 集成 "),s("a",{class:"header-anchor",href:"#解决方法二-多模网关搭配-home-assistant-集成","aria-label":"Permalink to “解决方法二：多模网关搭配 Home Assistant 集成”"},"​")],-1)),s("p",null,[t[27]||(t[27]=i("想回答这个问题这要提到 Home Assistant 文档中科普的",-1)),e(o,{href:"https://www.home-assistant.io/blog/2016/02/12/classifying-the-internet-of-things/#classifiers",target:"_blank",rel:"noreferrer"},{default:n(()=>[...t[26]||(t[26]=[i("物联网智能家居设备的几种类型",-1)])]),_:1}),t[28]||(t[28]=i("：",-1))]),t[45]||(t[45]=a('<table tabindex="0"><thead><tr><th>类型</th><th>介绍</th></tr></thead><tbody><tr><td>推测状态 Assumed State</td><td>无法获取状态，只能根据最后的指令推测、假定。</td></tr><tr><td>云端轮询 Cloud Polling</td><td>Home Assistant 定时向云端查询状态，所以互联网连接必须得到保证，至少要在轮询发起前建立连接。同时轮询意味着状态刷新必然会有明显的延迟（主要是轮询周期，其次通讯时延、服务器响应时延等）。</td></tr><tr><td>云端推送 Cloud Push</td><td>云端服务器在状态变化时向 Home Assistant 推送通知，这要求互联网连接必须一直保持。显然这种方式比轮询更加高效，时延也会更短。</td></tr><tr><td>本地轮询 Local Polling</td><td>提供与设备的直接通信。轮询状态意味着稍后可能会注意到更新。</td></tr><tr><td>本地推送 Local Push</td><td>提供与设备的直接通信。一旦有新状态，Home Assistant 就会收到通知。</td></tr></tbody></table><p>如何消除这个延迟呢？</p><h2 id="参考资料" tabindex="-1">参考资料 <a class="header-anchor" href="#参考资料" aria-label="Permalink to “参考资料”">​</a></h2>',3)),s("ul",null,[s("li",null,[e(o,{href:"https://bbs.hassbian.com/thread-14225-1-1.html",target:"_blank",rel:"noreferrer"},{default:n(()=>[...t[29]||(t[29]=[i("【新手必读】入门->精通：HA安装方式、基本概念及来龙去脉 - 『HomeAssistant』新手入门区 - 『瀚思彼岸』» 智能家居技术论坛 - Powered by Discuz!",-1)])]),_:1})]),s("li",null,[e(o,{href:"https://www.home-assistant.io/blog/2016/02/12/classifying-the-internet-of-things/#classifiers",target:"_blank",rel:"noreferrer"},{default:n(()=>[...t[30]||(t[30]=[i("Classifying the Internet of Things - Home Assistant",-1)])]),_:1})]),s("li",null,[e(o,{href:"https://github.com/al-one/hass-xiaomi-miot/issues/100#issuecomment-909031222",target:"_blank",rel:"noreferrer"},{default:n(()=>[...t[31]||(t[31]=[i("FAQ - 常见问题 · Issue #100 · al-one/hass-xiaomi-miot",-1)])]),_:1})])]),t[46]||(t[46]=s("h2",{id:"延伸阅读",tabindex:"-1"},[i("延伸阅读 "),s("a",{class:"header-anchor",href:"#延伸阅读","aria-label":"Permalink to “延伸阅读”"},"​")],-1)),s("ul",null,[s("li",null,[e(o,{href:"https://github.com/AlexxIT/XiaomiGateway3#how-it-works",target:"_blank",rel:"noreferrer"},{default:n(()=>[...t[32]||(t[32]=[i("AlexxIT/XiaomiGateway3: Control Zigbee, BLE and Mesh devices from Home Assistant with Xiaomi Gateway 3 on original firmware",-1)])]),_:1})]),s("li",null,[e(o,{href:"https://www.zigbee2mqtt.io/guide/getting-started/#installation",target:"_blank",rel:"noreferrer"},{default:n(()=>[...t[33]||(t[33]=[i("Getting started | Zigbee2MQTT",-1)])]),_:1})])]),e(m),e(d),t[47]||(t[47]=s("hr",{class:"footnotes-sep"},null,-1)),s("section",k,[s("ol",g,[s("li",h,[s("p",null,[t[35]||(t[35]=i("在 ",-1)),e(o,{href:"https://github.com/al-one/hass-xiaomi-miot/issues/100#issuecomment-909031222",target:"_blank",rel:"noreferrer"},{default:n(()=>[...t[34]||(t[34]=[i("为什么设备状态会有延迟？如何减小延迟？",-1)])]),_:1}),t[36]||(t[36]=i(" 中提及：延迟通常是指通过米家APP或物理按键等操作设备后，设备在HA中的实体状态要等几秒甚至十几秒后才会更新。原因是本插件目前主要是通过轮询的方式获取设备状态，通俗的讲就是每隔几十秒去刷新一次状态。现在这个时间是 30s。 ",-1)),t[37]||(t[37]=s("a",{href:"#fnref1",class:"footnote-backref"},"↩︎",-1))])])])])])}const N=f(b,[["render",A]]);export{T as __pageData,N as default};
